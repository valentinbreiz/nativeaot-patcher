typedef unsigned int size_t;

// A function decorated either with `UnmanagedCallersOnly` or `RuntimeExport` attributes in `Cosmos.Kernel`
extern void __Initialize_Kernel();
// Generated by ilc at compile time when the parameter `--nativelib` is present.
extern void __managed__Startup();
// Tentative name, this function would be exposed by the User's Main Project.
extern void __managed__Main();

// This field is inspected from the generated code to determine what intrinsics are available.
extern int g_cpuFeatures;
int g_cpuFeatures = 0;

// This field is defined in the generated code and sets the ISA expectations.
extern int g_requiredCpuFeatures;

#ifdef __x86_64__
// Platform-specific initialization for x64 (enabling SSE)
extern void EnableSSE();
#endif

extern void* __Modules_start[]; // Start of __modules Section
extern void* __Modules_end[];   // End of __modules Section

// Entry point
void kmain()
{
#ifdef __x86_64__
    EnableSSE();
#endif
    // ARM64: NEON is enabled by default, no initialization needed

    __Initialize_Kernel();
    __managed__Startup();
    __managed__Main();
}

// Return the size of the '__modules' section and
// populates 'modules' with a pointer to the start of the section.
extern size_t GetModules(void** modules)
{
    *modules = __Modules_start;
    //return sizeof(size_t);
    return  __Modules_end - __Modules_start;
}
