<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <!-- Architecture Detection from RuntimeIdentifier -->
  <PropertyGroup>
    <!-- Parse architecture from RuntimeIdentifier (e.g., linux-x64, win-arm64, osx-arm64) -->
    <CosmosArch Condition="'$(RuntimeIdentifier)' != '' AND '$(CosmosArch)' == ''">$([System.String]::Copy('$(RuntimeIdentifier)').Split('-')[1])</CosmosArch>

    <!-- Default to x64 if not specified -->
    <CosmosArch Condition="'$(CosmosArch)' == ''">x64</CosmosArch>

    <!-- Normalize architecture names -->
    <CosmosArch Condition="'$(CosmosArch)' == 'x86_64'">x64</CosmosArch>
    <CosmosArch Condition="'$(CosmosArch)' == 'aarch64'">arm64</CosmosArch>

    <!-- Set architecture-specific defines -->
    <DefineConstants Condition="'$(CosmosArch)' == 'x64'">$(DefineConstants);ARCH_X64</DefineConstants>
    <DefineConstants Condition="'$(CosmosArch)' == 'arm64'">$(DefineConstants);ARCH_ARM64</DefineConstants>
  </PropertyGroup>

  <!-- Architecture-specific tool paths -->
  <PropertyGroup Condition="'$(CosmosArch)' == 'x64'">
    <CosmosAssembler>yasm</CosmosAssembler>
    <CosmosAssemblerFormat>elf64</CosmosAssemblerFormat>
    <CosmosLinkerEmulation>elf_x86_64</CosmosLinkerEmulation>
    <CosmosGccTarget>x86_64-elf</CosmosGccTarget>
  </PropertyGroup>

  <PropertyGroup Condition="'$(CosmosArch)' == 'arm64'">
    <CosmosAssembler>aarch64-elf-as</CosmosAssembler>
    <CosmosAssemblerFormat>elf64</CosmosAssemblerFormat>
    <CosmosLinkerEmulation>aarch64elf</CosmosLinkerEmulation>
    <CosmosGccTarget>aarch64-elf</CosmosGccTarget>
  </PropertyGroup>

  <!-- Set default native package version if not specified -->
  <PropertyGroup>
    <CosmosNativePackageVersion Condition="'$(CosmosNativePackageVersion)' == ''">3.0.0</CosmosNativePackageVersion>
  </PropertyGroup>

  <!-- Architecture-specific native package references -->
  <ItemGroup Condition="'$(CosmosArch)' == 'x64'">
    <PackageReference Include="Cosmos.Kernel.Native.x64" Version="$(CosmosNativePackageVersion)" />
  </ItemGroup>

  <ItemGroup Condition="'$(CosmosArch)' == 'arm64'">
    <PackageReference Include="Cosmos.Kernel.Native.ARM64" Version="$(CosmosNativePackageVersion)" />
  </ItemGroup>

</Project>
