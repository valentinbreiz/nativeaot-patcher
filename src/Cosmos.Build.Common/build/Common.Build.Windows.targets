<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <!-- Input path passed as a parameter (Correct version [oops])-->
    <IsoRoot Condition="'$(IsoRoot)' == ''">$(DefaultIsoRoot)</IsoRoot>

    <!-- Ensure IsoRoot is an absolute path before converting to Cygwin format -->
    <IsoRootAbsolute>$([System.IO.Path]::GetFullPath('$(IsoRoot)'))</IsoRootAbsolute>

    <!-- Replace ':' with '' (remove colon after drive letter) -->
    <IsoRootNoColon>$([System.String]::Copy('$(IsoRootAbsolute)').Replace(':', ''))</IsoRootNoColon>

    <!-- Replace backslashes with slashes -->
    <IsoRootSlashes>$([System.String]::Copy('$(IsoRootNoColon)').Replace('\', '/'))</IsoRootSlashes>

    <!-- Add cygdrive prefix -->
    <FinalIsoRoot>/cygdrive/$(IsoRootSlashes)</FinalIsoRoot>
  </PropertyGroup>

  <Target Name="GetLinker">
    <Exec Command="where ld.lld" IgnoreExitCode="true" StandardOutputImportance="Low" ConsoleToMsBuild="true"
          Condition="$(LdLinkerPath) ==''">
      <Output TaskParameter="ConsoleOutput" PropertyName="LdLinkerPath" />
    </Exec>
  </Target>

  <Target Name="GetXorriso" BeforeTargets="BuildISO">
    <PropertyGroup>
      <XorrisoDir>$([MSBuild]::NormalizePath('$(CosmosIntermediateOutputPath)', 'xorriso'))</XorrisoDir>
    </PropertyGroup>
    <Exec Command="git clone https://github.com/PeyTy/xorriso-exe-for-windows.git --depth=1 &quot;$(XorrisoDir)&quot;" IgnoreExitCode="true"/>
    <PropertyGroup>
      <XorrisoBinary>$([MSBuild]::NormalizePath('$(XorrisoDir)', 'xorriso.exe'))</XorrisoBinary>
    </PropertyGroup>
  </Target>

</Project>
