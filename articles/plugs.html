<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title> | Cosmos Gen 3 </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content=" | Cosmos Gen 3 ">
      
      
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/valentinbreiz/nativeaot-patcher/blob/262/merge/docs/articles/plugs.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.svg" alt="Cosmos Gen 3">
            Cosmos Gen 3
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">

<p>A <strong>plug</strong> is a mechanism that replaces existing methods, variables, or types with custom implementations to enable platform-specific functionality (<a href="https://cosmosos.github.io/articles/Kernel/Plugs.html">what is a plug?</a>).</p>
<h2 id="plug-related-attributes">Plug-related attributes</h2>
<h3 id="plug"><code>[Plug]</code></h3>
<p>Marks a class as the replacement for a target type. The attribute accepts the fully qualified name of the type to replace and optional flags to skip missing targets or substitute base implementations. See the definition in <a href="../../src/Cosmos.Build.API/Attributes/PlugAttribute.cs">PlugAttribute.cs</a> for details.</p>
<p><strong>Use when:</strong> creating a plug class that substitutes an existing type.</p>
<p><strong>Pitfalls:</strong> mismatched <code>TargetName</code> can break builds.</p>
<h3 id="plugmember"><code>[PlugMember]</code></h3>
<p>Indicates that a member should replace a member on the target type. The attribute can be applied to fields, properties, or methods. Its implementation is available in <a href="../../src/Cosmos.Build.API/Attributes/PlugMemberAttribute.cs">PlugMemberAttribute.cs</a>.</p>
<p><strong>Use when:</strong> you need fineâ€‘grained control over which members of the target type are replaced.</p>
<p><strong>Pitfalls:</strong> ensure signatures match the target member; otherwise the patcher cannot wire them up correctly.</p>
<h3 id="expose"><code>[Expose]</code></h3>
<p>Adds new private members to the target type so that plugs can use them. The attribute is useful for introducing fields or methods that are not part of the original type.</p>
<p><strong>Use when:</strong> a plug requires additional private storage or logic.</p>
<p><strong>Pitfalls:</strong> exposing members that conflict with existing names can cause unpredictable behavior.</p>
<h3 id="fieldaccess"><code>[FieldAccess]</code></h3>
<p>Allows a plug method to access private fields of the target type by mapping a parameter to a specific field name. The patcher rewrites the method's IL to reference the requested field (see <code>ReplaceFieldAccess</code> in <a href="../../src/Cosmos.Patcher/PlugPatcher.cs">PlugPatcher.cs</a>).</p>
<p><strong>Use when:</strong> accessing or modifying an object field inside a plugged method.</p>
<p><strong>Pitfalls:</strong> incorrect field names or mismatched parameter types result in runtime failures when the patcher attempts to rewrite field accesses.</p>
<h2 id="cosmos-gen3-plug-template">Cosmos gen3 plug template</h2>
<p><em>Feel free to propose changes</em></p>
<pre><code class="lang-csharp">using System.IO;

namespace Cosmos.Plugs;

[Plug(typeof(System.IO.FileStream))]
public class FileStream
{
    /* Plug static fields from System.IO.FileStream */
    [PlugMember]
    public static ulong StaticField
    {
         get; set;
    }

    /* Plug instance fields from System.IO.FileStream */
    [PlugMember]
    public static ulong classInstanceField
    {
         get; set;
    }

    /* Add private static fields to plugged class */
    [Expose]
    private static ulong _privateStaticField;

    /* Add private fields to plugged class */
    [Expose]
    private static ulong _privateInstanceField;

    /* Add private static methods to plugged class */
    [Expose]
    private static void PrivateStaticMethod()
    {
    }

    /* Add private objects methods to plugged class */
    [Expose]
    private static void PrivateInstanceMethod(FileStream aThis)
    {
        aThis.WriteByte('a');
    }

    /* Plug non static method with aThis to access fields */
    [PlugMember]
    public static long Seek(FileStream aThis, long offset, SeekOrigin origin)
    {
        PrivateMethod();
        _privateInstanceField = 0;
        aThis.WriteByte('a');
        classStaticField = 0;
        aThis.classInstanceField = 0; //or classInstanceField = 0;
        // ...
    }

    /* Plug static method */
    [PlugMember]
    public static long StaticMethod()
    {

    }

    /* Access private fields from plugged class */
    [PlugMember]
    public static long AccessFieldsMethod(FileStream aThis, [FieldAccess(Name = &quot;InstanceField2&quot;)] ulong InstanceField2)
    {
        InstanceField2 = 0;
    }

    /* Assembly plug for System.IO.FileStream.WriteByte */
    [PlugMember, RuntimeImport(&quot;asm_writebyte&quot;)]
    public static void WriteByte(FileStream aThis, byte b);

}
</code></pre>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/valentinbreiz/nativeaot-patcher/blob/262/merge/docs/articles/plugs.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
