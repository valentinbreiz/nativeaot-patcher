#!/bin/sh
# Pre-commit hook to enforce formatting using dotnet format on unstaged changes only.

REPO_ROOT=$(git rev-parse --show-toplevel)
cd "$REPO_ROOT" || exit 1

# Get unstaged C# files (excluding deleted files)
C_SHARP_FILES=$(git diff HEAD --name-only --diff-filter=AM -- '*.cs')

if [ -z "$C_SHARP_FILES" ]; then
    echo "No C# files to format or lint."
    exit 0
fi

# Run dotnet format with the --check flag to verify formatting
dotnet format --include $(echo "$C_SHARP_FILES" | tr '\n' ' ') --verify-no-changes
RESULT=$?

if [ $RESULT -ne 0 ]; then
    echo "Code formatting issues detected. Run 'dotnet format' to fix them."
    exit 1
fi

echo "All files are correctly formatted."
exit 0
